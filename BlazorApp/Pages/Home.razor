@page "/inicio"
@attribute [Authorize]
@inject IJSRuntime JS

<PageTitle>Inicio</PageTitle>

<AuthorizeView Context="auth">
    <Authorized>
        <div class="home-wrap">
            @if (showWelcome)
            {
                <section class="welcome-panel">
                    <div class="welcome-head">
                        <span class="bi bi-stars" aria-hidden="true"></span>
                        <strong>¡Bienvenido, @auth.User.Identity!.Name!</strong>
                        <button class="icon-btn" type="button" title="Cerrar" @onclick="CloseWelcome">
                            <span class="bi bi-x-lg" aria-hidden="true"></span>
                        </button>
                    </div>
                    <p class="muted">
                        Este es el panel de administración de <b>Inventario</b>.
                        Gestioná productos, ventas, pedidos y tipos de producto desde el menú de la izquierda.
                    </p>
                </section>
            }
        </div>
    </Authorized>
    <NotAuthorized>
        <RedirectTo Url="/login" />
    </NotAuthorized>
</AuthorizeView>

@code {
    private bool showWelcome = true;
    private bool _loadedWelcome = false;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (!firstRender || _loadedWelcome) return;

        try
        {
            var val = await JS.InvokeAsync<string?>("localStorage.getItem", "hideWelcome");
            showWelcome = val != "1";
            _loadedWelcome = true;
            StateHasChanged();
        }
        catch
        {
            _loadedWelcome = true;
        }
    }

    private async Task CloseWelcome()
    {
        showWelcome = false;
        try
        {
            await JS.InvokeVoidAsync("localStorage.setItem", "hideWelcome", "1");
        }
        catch { /* ignore */ }
    }
}
