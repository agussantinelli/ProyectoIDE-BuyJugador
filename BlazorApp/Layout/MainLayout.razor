@inherits LayoutComponentBase
@inject AuthenticationStateProvider AuthStateProvider
@inject NavigationManager Nav
@inject IJSRuntime JS

<div class="app-shell @(isCollapsed ? "collapsed" : "")">
    <aside class="sidebar">
        <div class="sidebar-header">
            <button class="icon-btn menu-toggle" @onclick="ToggleSidebar" title="Menú">
                <span class="bi bi-list"></span>
            </button>
            <div class="brand-mini" @onclick="@(() => Nav.NavigateTo("/"))">
                <span class="bi bi-box-seam"></span>
            </div>
        </div>

        <nav class="sidebar-nav">
            <nav class="sidebar-nav">
                <NavLink class="nav-item" href="/" Match="NavLinkMatch.All">
                    <span class="bi bi-house-door"></span>
                    <span class="nav-label">Inicio</span>
                </NavLink>
                <NavLink class="nav-item" href="/producto">
                    <span class="bi bi-bag"></span>
                    <span class="nav-label">Productos</span>
                </NavLink>
                <NavLink class="nav-item" href="/venta">
                    <span class="bi bi-receipt"></span>
                    <span class="nav-label">Ventas</span>
                </NavLink>
                <NavLink class="nav-item" href="/pedido">
                    <span class="bi bi-truck"></span>
                    <span class="nav-label">Pedidos</span>
                </NavLink>
                <NavLink class="nav-item" href="/tipo-producto">
                    <span class="bi bi-tags"></span>
                    <span class="nav-label">Tipos de producto</span>
                </NavLink>
                <NavLink class="nav-item" href="/persona">
                    <span class="bi bi-person-lines-fill"></span>
                    <span class="nav-label">Personas</span>
                </NavLink>
                <NavLink class="nav-item" href="/proveedor">
                    <span class="bi bi-building"></span>
                    <span class="nav-label">Proveedores</span>
                </NavLink>
            </nav>
        </nav>
    </aside>

    <section class="main">
        <header class="topbar">
            <div class="brand-centered" @onclick="@(() => Nav.NavigateTo("/"))">
                <img src="logo.svg" alt="Logo" class="brand-logo" />
                <strong class="brand-title">Inventario</strong>
            </div>

            <AuthorizeView>
                <Authorized>
                    <div class="user-area">
                        <span class="text-muted">Hola,</span>
                        <strong>@(context.User.Identity?.Name ?? "Usuario")</strong>
                        <button class="btn btn-link" @onclick="Logout">Logout</button>
                    </div>
                </Authorized>
                <NotAuthorized>
                    <RedirectTo Url="/login" />
                </NotAuthorized>
            </AuthorizeView>
        </header>

        <main class="content">
            @Body
        </main>
    </section>
</div>

@code {
    private bool isCollapsed = false;

    private void ToggleSidebar()
    {
        isCollapsed = !isCollapsed;
    }

    private async Task Logout()
    {
        if (AuthStateProvider is CustomAuthenticationStateProvider provider)
        {
            await provider.MarkUserAsLoggedOutAsync();
            Nav.NavigateTo("/login");
        }
    }
}
